const t=new DOMMatrixReadOnly([1,0,0,1,0,0]);class e{constructor(){this.currTrans=t,this.ID=e.nextID++}Update(t){}Draw(t){this.currTrans=t.getTransform()}RelativePoint(t){return this.calcPoint(t,this.currTrans.inverse())}AbsolutePoint(t){return this.calcPoint(t,this.currTrans)}calcPoint(t,e){let[s,i]=t;return[e.a*s+e.c*i+e.e,e.b*s+e.d*i+e.f]}}e.nextID=0;class s extends e{constructor(){super(),this.listeners=new Map}OnEvent(t,e){let s=this.listeners.get(t);void 0===s&&(s=[]),s.push(e),this.listeners.set(t,s)}FireEvent(t,...e){let s=this.listeners.get(t);void 0!==s&&s.forEach((s=>s.bind(this)(t,...e)))}}var i;!function(t){t.KeyPressed="KeyPressed",t.KeyReleased="KeyReleased",t.MousePressed="MousePressed",t.MouseReleased="MouseReleased",t.MouseMoved="MouseMoved",t.GotFocus="GotFocus",t.LostFocus="LostFocus"}(i||(i={}));class r extends Array{constructor(){super()}Update(t){super.forEach((e=>{e.Update(t)}))}Draw(t){super.forEach((e=>{let s=e.X,i=e.Y;t.translate(s,i),e.Draw(t),t.translate(-s,-i)}))}FireEvent(t,...e){super.forEach((s=>{s.Focusing&&s.FireEvent(t,...e)}))}}class n{constructor(t){this.ctx=t}get Width(){return this.ctx.canvas.width}get Height(){return this.ctx.canvas.height}}class h{static FromContext(t){return new h(new n(t))}constructor(t){this.shape=t}Put(t,...e){}CalcWidth(t){return this.shape.Width}CalcHeight(t){return this.shape.Height}CalcX(t){return 0}CalcY(t){return 0}}class o extends Array{addWidget(t,e){void 0!==e?super.splice(e,0,t):super.push(t)}searchOrder(t){let e=super.findIndex((e=>e.ID==t.ID));if(!(e<0))return e}}class a{constructor(t){this.widgets=new o,this.shape=t}Put(t,...e){this.widgets.addWidget(t,e[0])}CalcWidth(t){return void 0===this.widgets.searchOrder(t)?0:this.shape.Width/this.widgets.length}CalcHeight(t){return void 0===this.widgets.searchOrder(t)?0:this.shape.Height}CalcX(t){let e=this.widgets.searchOrder(t);return void 0===e?0:this.CalcWidth(t)*e}CalcY(t){return 0}}class u extends s{constructor(t){super(),this.focusing=!1,this.coordinator=t}get Width(){return this.coordinator.CalcWidth(this)}get Height(){return this.coordinator.CalcHeight(this)}get X(){return this.coordinator.CalcX(this)}get Y(){return this.coordinator.CalcY(this)}get Focusing(){return this.focusing}set Focusing(t){this.focusing!=t&&(this.focusing=t,this.FireEvent(t?i.GotFocus:i.LostFocus))}}class d extends u{constructor(t){super(t),this.layout=new h(this),this.children=new r}Reset(t){this.layout=t,this.children=new r}get Layout(){return this.layout}Append(t,...e){this.children.push(t),this.layout.Put(t,...e)}Update(t){super.Update(t),this.children.Update(t)}Draw(t){super.Draw(t),this.children.Draw(t)}FireEvent(t,...e){super.FireEvent(t,...e),this.children.FireEvent(t,...e)}}class l{constructor(t){this.heartbeat=500,this.Main=t}WithHeartbeat(t){return this.heartbeat=t,this}Bind(t){this.registerUpdater(),this.registerDrawer(t),this.registerListener(t)}registerUpdater(){const t=this.Main;let e=Date.now();setInterval((()=>{let s=Date.now();t.Update(s-e),e=s}),this.heartbeat)}registerDrawer(t){const e=this.Main,s=()=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),e.Draw(t),requestAnimationFrame(s)};requestAnimationFrame(s)}registerListener(t){if(!(this.Main instanceof s))return;const e=this.Main,r=t.canvas;r.addEventListener("keydown",(t=>{if(t.repeat)return;let s=t.key;e.FireEvent(i.KeyPressed,s)})),r.addEventListener("keyup",(t=>{let s=t.key;e.FireEvent(i.KeyReleased,s)})),r.addEventListener("mousedown",(t=>{let s=t.button-1,r=t.offsetX,n=t.offsetY;e.FireEvent(i.MousePressed,s,[r,n])})),r.addEventListener("mouseup",(t=>{let s=t.button-1,r=t.offsetX,n=t.offsetY;e.FireEvent(i.MouseReleased,s,[r,n])})),r.addEventListener("mousemove",(t=>{let s=t.offsetX,r=t.offsetY;e.FireEvent(i.MouseMoved,[s,r])}))}}const c=(t,e)=>101325*Math.exp(0-.284095512372*e/8.314462618/t),g=273.15-50,p=323.15,v=15e3;class M extends u{constructor(t,e){super(t),this.pressing=!1,this.stat=e,this.OnEvent(i.MouseMoved,this.onMouseMoved),this.OnEvent(i.MousePressed,this.onMousePressed),this.OnEvent(i.MouseReleased,this.onMouseReleased)}Draw(t){super.Draw(t);let e=c(this.stat.T,1),s=c(this.stat.T,v),i=t=>{let i=t/100*14999+1;return(c(this.stat.T,i)-s)/(e-s)*100},r=t.createLinearGradient(0,this.Height,0,0);for(let t=0;t<=100;t++){let e=i(t)/100*255;r.addColorStop(t/100,`rgb(${e} ${e} 255)`)}t.fillStyle=r,t.fillRect(0,0,this.Width,this.Height);let n=this.Height-(this.stat.h-1)/14999*this.Height;t.moveTo(0,n),t.lineTo(this.Width,n),t.lineWidth=1,t.strokeStyle="red",t.stroke(),t.fillStyle="red",t.fillText(`height: ${this.stat.h.toFixed(3)}m`,2,n-2)}updateStat(t,e){this.stat.h=(this.Height-e)/this.Height*14999+1}onMousePressed(t,e,s){if(e>=0)return;this.pressing=!0;let[i,r]=this.RelativePoint(s);this.updateStat(i,r)}onMouseReleased(t,e,s){if(e>=0)return;this.pressing=!1;let[i,r]=this.RelativePoint(s);this.updateStat(i,r)}onMouseMoved(t,e){if(!this.pressing)return;let[s,i]=this.RelativePoint(e);this.updateStat(s,i)}}class f extends u{constructor(t,e){super(t),this.pressing=!1,this.stat=e,this.OnEvent(i.MouseMoved,this.onMouseMoved),this.OnEvent(i.MousePressed,this.onMousePressed),this.OnEvent(i.MouseReleased,this.onMouseReleased)}Draw(t){super.Draw(t);let e=c(g,v),s=c(p,1),i=t=>{let i=100/this.Width*t+g,r=c(i,this.stat.h);return this.Height-this.Height/(s-e)*(r-e)};t.beginPath(),t.moveTo(0,i(0));for(let e=1;e<=100;e++){let s=e/100*this.Width,r=i(s);t.lineTo(s,r)}t.lineWidth=1,t.strokeStyle="red",t.stroke();let r=(this.stat.T-g)/100*this.Width,n=i(r);t.beginPath(),t.moveTo(r,0),t.lineTo(r,this.Height),t.moveTo(0,n),t.lineTo(this.Width,n),t.lineWidth=1,t.strokeStyle="blue",t.stroke(),t.fillStyle="blue",t.fillText(`temperature: ${this.stat.T.toFixed(3)}K`,r+2,this.Height-2),t.fillText(`P: ${(c(this.stat.T,this.stat.h)/1e3).toFixed(3)}kPa`,2,n-2)}updateStat(t,e){this.stat.T=t/this.Width*100+g}onMousePressed(t,e,s){if(e>=0)return;this.pressing=!0;let[i,r]=this.RelativePoint(s);this.updateStat(i,r)}onMouseReleased(t,e,s){if(e>=0)return;this.pressing=!1;let[i,r]=this.RelativePoint(s);this.updateStat(i,r)}onMouseMoved(t,e){if(!this.pressing)return;let[s,i]=this.RelativePoint(e);this.updateStat(s,i)}}class w extends d{constructor(t){super(h.FromContext(t)),this.stat={h:7500.5,T:273.15},this.Reset(new a(this)),this.leftW=new M(this.Layout,this.stat),this.Append(this.leftW),this.rightW=new f(this.Layout,this.stat),this.Append(this.rightW),this.Focusing=!0,this.OnEvent(i.MouseMoved,this.onMouseMoved)}onMouseMoved(t,e){let[s,i]=this.RelativePoint(e);this.leftW.Focusing=this.isOnWidget(s,i,this.leftW),this.rightW.Focusing=this.isOnWidget(s,i,this.rightW)}isOnWidget(t,e,s){return t>s.X&&t<s.X+s.Width&&e>s.Y&&e<s.Y+s.Height}}class W{constructor(t){this.container=t}Setup(){let t=this.container.getContext("2d");if(null===t)return void console.error("can't get 2d context from canvas tag");let e=new w(t);new l(e).Bind(t)}}(()=>{let t=document.getElementById("app");null!=t?new W(t).Setup():console.error("no app container found")})();
